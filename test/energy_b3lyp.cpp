#include "gtest/gtest.h"
#include "XCint.h"
#include "MemAllocator.h"
#include "xcint_c_interface.h"

TEST(energy, b3lyp)
{
    XCint xc;
    xc.set_verbosity(0);
    int num_centers;
    int num_shells;
    double *center_xyz = NULL;
    int *center_element = NULL;
    int *shell_center = NULL;
    int *l_quantum_num = NULL;
    int *shell_num_primitives = NULL;
    double *primitive_exp = NULL;
    double *contraction_coef = NULL;
    size_t block_size;
    num_centers = 2;
    num_shells = 9;
    block_size = 3*num_centers*sizeof(double);
    center_xyz = (double*) MemAllocator::allocate(block_size);
    center_xyz[0] =   1.700000000000e+00;
    center_xyz[1] =   0.000000000000e+00;
    center_xyz[2] =   0.000000000000e+00;
    center_xyz[3] =   0.000000000000e+00;
    center_xyz[4] =   0.000000000000e+00;
    center_xyz[5] =   0.000000000000e+00;
    block_size = num_centers*sizeof(int);
    center_element = (int*) MemAllocator::allocate(block_size);
    center_element[0] = 9;
    center_element[1] = 1;
    block_size = num_shells*sizeof(int);
    shell_center = (int*) MemAllocator::allocate(block_size);
    l_quantum_num = (int*) MemAllocator::allocate(block_size);
    shell_num_primitives = (int*) MemAllocator::allocate(block_size);
    shell_center[0] = 1;
    l_quantum_num[0] = 0;
    shell_num_primitives[0] = 9;
    shell_center[1] = 1;
    l_quantum_num[1] = 0;
    shell_num_primitives[1] = 9;
    shell_center[2] = 1;
    l_quantum_num[2] = 0;
    shell_num_primitives[2] = 1;
    shell_center[3] = 1;
    l_quantum_num[3] = 1;
    shell_num_primitives[3] = 4;
    shell_center[4] = 1;
    l_quantum_num[4] = 1;
    shell_num_primitives[4] = 1;
    shell_center[5] = 1;
    l_quantum_num[5] = 2;
    shell_num_primitives[5] = 1;
    shell_center[6] = 2;
    l_quantum_num[6] = 0;
    shell_num_primitives[6] = 4;
    shell_center[7] = 2;
    l_quantum_num[7] = 0;
    shell_num_primitives[7] = 1;
    shell_center[8] = 2;
    l_quantum_num[8] = 1;
    shell_num_primitives[8] = 1;
    block_size = 31*sizeof(double);
    primitive_exp = (double*) MemAllocator::allocate(block_size);
    contraction_coef = (double*) MemAllocator::allocate(block_size);
    primitive_exp[0] =   1.471000000000e+04;
    contraction_coef[0] =   6.863650000000e-01;
    primitive_exp[1] =   2.207000000000e+03;
    contraction_coef[1] =   1.274350000000e+00;
    primitive_exp[2] =   5.028000000000e+02;
    contraction_coef[2] =   2.139130000000e+00;
    primitive_exp[3] =   1.426000000000e+02;
    contraction_coef[3] =   3.130550000000e+00;
    primitive_exp[4] =   4.647000000000e+01;
    contraction_coef[4] =   3.638230000000e+00;
    primitive_exp[5] =   1.670000000000e+01;
    contraction_coef[5] =   2.641480000000e+00;
    primitive_exp[6] =   6.356000000000e+00;
    contraction_coef[6] =   7.553570000000e-01;
    primitive_exp[7] =   1.316000000000e+00;
    contraction_coef[7] =   1.342700000000e-02;
    primitive_exp[8] =   3.897000000000e-01;
    contraction_coef[8] =  -8.197600000000e-04;
    primitive_exp[9] =   1.471000000000e+04;
    contraction_coef[9] =  -1.570740000000e-01;
    primitive_exp[10] =   2.207000000000e+03;
    contraction_coef[10] =  -3.001720000000e-01;
    primitive_exp[11] =   5.028000000000e+02;
    contraction_coef[11] =  -4.915140000000e-01;
    primitive_exp[12] =   1.426000000000e+02;
    contraction_coef[12] =  -7.849910000000e-01;
    primitive_exp[13] =   4.647000000000e+01;
    contraction_coef[13] =  -9.347560000000e-01;
    primitive_exp[14] =   1.670000000000e+01;
    contraction_coef[14] =  -1.005480000000e+00;
    primitive_exp[15] =   6.356000000000e+00;
    contraction_coef[15] =  -3.204660000000e-01;
    primitive_exp[16] =   1.316000000000e+00;
    contraction_coef[16] =   4.928530000000e-01;
    primitive_exp[17] =   3.897000000000e-01;
    contraction_coef[17] =   1.999410000000e-01;
    primitive_exp[18] =   3.897000000000e-01;
    contraction_coef[18] =   3.515260000000e-01;
    primitive_exp[19] =   2.267000000000e+01;
    contraction_coef[19] =   3.164380000000e+00;
    primitive_exp[20] =   4.977000000000e+00;
    contraction_coef[20] =   2.497710000000e+00;
    primitive_exp[21] =   1.347000000000e+00;
    contraction_coef[21] =   1.051860000000e+00;
    primitive_exp[22] =   3.471000000000e-01;
    contraction_coef[22] =   1.739750000000e-01;
    primitive_exp[23] =   3.471000000000e-01;
    contraction_coef[23] =   3.797590000000e-01;
    primitive_exp[24] =   1.640000000000e+00;
    contraction_coef[24] =   6.775590000000e+00;
    primitive_exp[25] =   1.301000000000e+01;
    contraction_coef[25] =   9.610660000000e-02;
    primitive_exp[26] =   1.962000000000e+00;
    contraction_coef[26] =   1.630200000000e-01;
    primitive_exp[27] =   4.446000000000e-01;
    contraction_coef[27] =   1.855450000000e-01;
    primitive_exp[28] =   1.220000000000e-01;
    contraction_coef[28] =   7.374380000000e-02;
    primitive_exp[29] =   1.220000000000e-01;
    contraction_coef[29] =   1.471230000000e-01;
    primitive_exp[30] =   7.270000000000e-01;
    contraction_coef[30] =   9.568810000000e-01;

    double hfx, mu, beta; // we don't care about it here
    xc.set_functional("b3lyp", hfx, mu, beta);
    xc.set_basis(XCINT_BASIS_SPHERICAL,
                 num_centers,
                 center_xyz,
                 center_element,
                 num_shells,
                 shell_center,
                 l_quantum_num,
                 shell_num_primitives,
                 primitive_exp,
                 contraction_coef);
    xc.generate_grid(1.0e-12,
                     86,
                     302,
                     num_centers,
                     center_xyz,
                     center_element,
                     num_shells,
                     shell_center,
                     l_quantum_num,
                     shell_num_primitives,
                     primitive_exp);
    int mat_dim = 19;
    double *dmat = NULL;
    double *xc_mat = NULL;
    block_size = mat_dim*mat_dim*sizeof(double);
    dmat = (double*) MemAllocator::allocate(block_size);
    xc_mat = (double*) MemAllocator::allocate(block_size);
    dmat[0] =   1.004012708363e+00;
    dmat[1] =   4.510701713634e-03;
    dmat[2] =  -1.144447782318e-02;
    dmat[3] =  -7.460192411188e-03;
    dmat[4] =  -3.522092749960e-17;
    dmat[5] =   1.163695681365e-16;
    dmat[6] =   2.064755862872e-03;
    dmat[7] =  -1.245926623264e-18;
    dmat[8] =   3.041985972867e-18;
    dmat[9] =   1.606870493197e-18;
    dmat[10] =   0.000000000000e+00;
    dmat[11] =  -9.392480166109e-05;
    dmat[12] =  -9.077384123154e-19;
    dmat[13] =   1.626825285678e-04;
    dmat[14] =   3.997745549303e-03;
    dmat[15] =  -3.957074064980e-04;
    dmat[16] =  -4.898578168207e-04;
    dmat[17] =  -3.581858288823e-18;
    dmat[18] =   2.490899479252e-18;
    dmat[19] =   4.510701713634e-03;
    dmat[20] =   9.194882886389e-01;
    dmat[21] =  -1.927744758881e-02;
    dmat[22] =   7.627553895467e-02;
    dmat[23] =  -1.647757200977e-16;
    dmat[24] =   5.098154007732e-16;
    dmat[25] =   4.461232796069e-02;
    dmat[26] =  -6.847735612893e-18;
    dmat[27] =   2.240697795427e-17;
    dmat[28] =   6.653608576548e-18;
    dmat[29] =   0.000000000000e+00;
    dmat[30] =  -1.407163850393e-03;
    dmat[31] =  -2.313939594075e-17;
    dmat[32] =   2.437279283440e-03;
    dmat[33] =   1.516892605146e-01;
    dmat[34] =  -7.579356306024e-02;
    dmat[35] =   3.450787865374e-02;
    dmat[36] =  -2.013225673072e-17;
    dmat[37] =   7.023700986329e-17;
    dmat[38] =  -1.144447782318e-02;
    dmat[39] =  -1.927744758881e-02;
    dmat[40] =   3.921259810966e-02;
    dmat[41] =   1.594594914555e-01;
    dmat[42] =   2.495189033712e-16;
    dmat[43] =  -8.108286832544e-16;
    dmat[44] =  -2.180960509113e-02;
    dmat[45] =   5.166562004020e-18;
    dmat[46] =  -1.680461996839e-17;
    dmat[47] =   9.087305960856e-19;
    dmat[48] =   0.000000000000e+00;
    dmat[49] =   1.737790248178e-03;
    dmat[50] =  -2.942035829792e-18;
    dmat[51] =  -3.009941002742e-03;
    dmat[52] =  -1.480858033152e-01;
    dmat[53] =   6.494868921324e-02;
    dmat[54] =  -1.106166966204e-02;
    dmat[55] =  -3.511440533640e-18;
    dmat[56] =   1.133298899672e-17;
    dmat[57] =  -7.460192411188e-03;
    dmat[58] =   7.627553895467e-02;
    dmat[59] =   1.594594914555e-01;
    dmat[60] =   6.762767650139e-01;
    dmat[61] =   3.827131694982e-17;
    dmat[62] =  -9.537171297195e-17;
    dmat[63] =  -8.309659505673e-02;
    dmat[64] =  -7.770249787749e-18;
    dmat[65] =   2.613399597324e-17;
    dmat[66] =   1.820982080103e-17;
    dmat[67] =   0.000000000000e+00;
    dmat[68] =   6.989016997025e-03;
    dmat[69] =  -5.967095286439e-17;
    dmat[70] =  -1.210533253381e-02;
    dmat[71] =  -5.903237520676e-01;
    dmat[72] =   2.573872675260e-01;
    dmat[73] =  -4.018642354126e-02;
    dmat[74] =  -5.648257781673e-17;
    dmat[75] =   1.849936072692e-16;
    dmat[76] =  -3.522092749960e-17;
    dmat[77] =  -1.647757200977e-16;
    dmat[78] =   2.495189033712e-16;
    dmat[79] =   3.827131694982e-17;
    dmat[80] =   9.296383420577e-01;
    dmat[81] =   9.673963290591e-18;
    dmat[82] =  -1.720433840850e-16;
    dmat[83] =   2.687064170209e-02;
    dmat[84] =  -2.873589052062e-18;
    dmat[85] =  -1.267372228454e-02;
    dmat[86] =   0.000000000000e+00;
    dmat[87] =   1.167180800302e-17;
    dmat[88] =   6.437086439663e-19;
    dmat[89] =  -2.021616447699e-17;
    dmat[90] =  -5.587506064397e-16;
    dmat[91] =   5.251770511735e-16;
    dmat[92] =  -8.219399021337e-17;
    dmat[93] =   3.668493529941e-02;
    dmat[94] =  -4.757810534507e-19;
    dmat[95] =   1.163695681365e-16;
    dmat[96] =   5.098154007732e-16;
    dmat[97] =  -8.108286832544e-16;
    dmat[98] =  -9.537171297195e-17;
    dmat[99] =   9.673963290591e-18;
    dmat[100] =   9.296383420577e-01;
    dmat[101] =   5.542069688632e-16;
    dmat[102] =  -8.418590979589e-18;
    dmat[103] =   2.687064170209e-02;
    dmat[104] =   8.396280264107e-19;
    dmat[105] =   0.000000000000e+00;
    dmat[106] =  -3.749820219002e-17;
    dmat[107] =  -1.267372228454e-02;
    dmat[108] =   6.494879138565e-17;
    dmat[109] =   1.857408973166e-15;
    dmat[110] =  -1.701790489248e-15;
    dmat[111] =   2.625606253250e-16;
    dmat[112] =   2.710042210071e-19;
    dmat[113] =   3.668493529941e-02;
    dmat[114] =   2.064755862872e-03;
    dmat[115] =   4.461232796069e-02;
    dmat[116] =  -2.180960509113e-02;
    dmat[117] =  -8.309659505673e-02;
    dmat[118] =  -1.720433840850e-16;
    dmat[119] =   5.542069688632e-16;
    dmat[120] =   1.341052289677e-02;
    dmat[121] =  -3.946627629946e-18;
    dmat[122] =   1.273061253772e-17;
    dmat[123] =   1.809247278039e-19;
    dmat[124] =   0.000000000000e+00;
    dmat[125] =  -9.888841932932e-04;
    dmat[126] =  -6.155876201271e-19;
    dmat[127] =   1.712797665585e-03;
    dmat[128] =   8.546811623303e-02;
    dmat[129] =  -3.783606332525e-02;
    dmat[130] =   7.250661042343e-03;
    dmat[131] =  -8.575436506057e-20;
    dmat[132] =   3.850230337473e-19;
    dmat[133] =  -1.245926623264e-18;
    dmat[134] =  -6.847735612893e-18;
    dmat[135] =   5.166562004020e-18;
    dmat[136] =  -7.770249787749e-18;
    dmat[137] =   2.687064170209e-02;
    dmat[138] =  -8.418590979589e-18;
    dmat[139] =  -3.946627629946e-18;
    dmat[140] =   7.766798687366e-04;
    dmat[141] =  -3.344761675525e-19;
    dmat[142] =  -3.663263821346e-04;
    dmat[143] =   0.000000000000e+00;
    dmat[144] =   2.482459642285e-19;
    dmat[145] =   1.371883698810e-19;
    dmat[146] =  -4.299746228054e-19;
    dmat[147] =  -8.660574448648e-18;
    dmat[148] =   1.192535041887e-17;
    dmat[149] =  -1.894385246426e-18;
    dmat[150] =   1.060356170457e-03;
    dmat[151] =  -3.569967801147e-19;
    dmat[152] =   3.041985972867e-18;
    dmat[153] =   2.240697795427e-17;
    dmat[154] =  -1.680461996839e-17;
    dmat[155] =   2.613399597324e-17;
    dmat[156] =  -2.873589052062e-18;
    dmat[157] =   2.687064170209e-02;
    dmat[158] =   1.273061253772e-17;
    dmat[159] =  -3.344761675525e-19;
    dmat[160] =   7.766798687367e-04;
    dmat[161] =   6.725655634183e-20;
    dmat[162] =   0.000000000000e+00;
    dmat[163] =  -7.959263223244e-19;
    dmat[164] =  -3.663263821346e-04;
    dmat[165] =   1.378584829348e-18;
    dmat[166] =   2.952603434641e-17;
    dmat[167] =  -3.870149159146e-17;
    dmat[168] =   6.061542580228e-18;
    dmat[169] =  -1.165974145915e-19;
    dmat[170] =   1.060356170457e-03;
    dmat[171] =   1.606870493197e-18;
    dmat[172] =   6.653608576548e-18;
    dmat[173] =   9.087305960856e-19;
    dmat[174] =   1.820982080103e-17;
    dmat[175] =  -1.267372228454e-02;
    dmat[176] =   8.396280264107e-19;
    dmat[177] =   1.809247278039e-19;
    dmat[178] =  -3.663263821346e-04;
    dmat[179] =   6.725655634183e-20;
    dmat[180] =   1.727803483127e-04;
    dmat[181] =   0.000000000000e+00;
    dmat[182] =   2.892558342562e-20;
    dmat[183] =  -2.202024583980e-20;
    dmat[184] =  -5.010058013771e-20;
    dmat[185] =  -8.188577127075e-18;
    dmat[186] =  -2.906136692737e-19;
    dmat[187] =   1.042755863658e-19;
    dmat[188] =  -5.001242536768e-04;
    dmat[189] =   4.482367662333e-20;
    dmat[190] =   0.000000000000e+00;
    dmat[191] =   0.000000000000e+00;
    dmat[192] =   0.000000000000e+00;
    dmat[193] =   0.000000000000e+00;
    dmat[194] =   0.000000000000e+00;
    dmat[195] =   0.000000000000e+00;
    dmat[196] =   0.000000000000e+00;
    dmat[197] =   0.000000000000e+00;
    dmat[198] =   0.000000000000e+00;
    dmat[199] =   0.000000000000e+00;
    dmat[200] =   0.000000000000e+00;
    dmat[201] =   0.000000000000e+00;
    dmat[202] =   0.000000000000e+00;
    dmat[203] =   0.000000000000e+00;
    dmat[204] =   0.000000000000e+00;
    dmat[205] =   0.000000000000e+00;
    dmat[206] =   0.000000000000e+00;
    dmat[207] =   0.000000000000e+00;
    dmat[208] =   0.000000000000e+00;
    dmat[209] =  -9.392480166109e-05;
    dmat[210] =  -1.407163850393e-03;
    dmat[211] =   1.737790248178e-03;
    dmat[212] =   6.989016997025e-03;
    dmat[213] =   1.167180800302e-17;
    dmat[214] =  -3.749820219002e-17;
    dmat[215] =  -9.888841932932e-04;
    dmat[216] =   2.482459642285e-19;
    dmat[217] =  -7.959263223244e-19;
    dmat[218] =   2.892558342562e-20;
    dmat[219] =   0.000000000000e+00;
    dmat[220] =   7.751986552912e-05;
    dmat[221] =  -9.645347373006e-20;
    dmat[222] =  -1.342683456924e-04;
    dmat[223] =  -6.626796710079e-03;
    dmat[224] =   2.912618333097e-03;
    dmat[225] =  -5.094002105433e-04;
    dmat[226] =  -1.216453818675e-19;
    dmat[227] =   4.014995998348e-19;
    dmat[228] =  -9.077384123154e-19;
    dmat[229] =  -2.313939594075e-17;
    dmat[230] =  -2.942035829792e-18;
    dmat[231] =  -5.967095286439e-17;
    dmat[232] =   6.437086439663e-19;
    dmat[233] =  -1.267372228454e-02;
    dmat[234] =  -6.155876201271e-19;
    dmat[235] =   1.371883698810e-19;
    dmat[236] =  -3.663263821346e-04;
    dmat[237] =  -2.202024583980e-20;
    dmat[238] =   0.000000000000e+00;
    dmat[239] =  -9.645347373006e-20;
    dmat[240] =   1.727803483127e-04;
    dmat[241] =   1.670623170670e-19;
    dmat[242] =   2.566820530999e-17;
    dmat[243] =   1.066988590732e-18;
    dmat[244] =  -3.555822098220e-19;
    dmat[245] =   2.691149404880e-20;
    dmat[246] =  -5.001242536767e-04;
    dmat[247] =   1.626825285678e-04;
    dmat[248] =   2.437279283440e-03;
    dmat[249] =  -3.009941002742e-03;
    dmat[250] =  -1.210533253381e-02;
    dmat[251] =  -2.021616447699e-17;
    dmat[252] =   6.494879138565e-17;
    dmat[253] =   1.712797665585e-03;
    dmat[254] =  -4.299746228054e-19;
    dmat[255] =   1.378584829348e-18;
    dmat[256] =  -5.010058013771e-20;
    dmat[257] =   0.000000000000e+00;
    dmat[258] =  -1.342683456924e-04;
    dmat[259] =   1.670623170670e-19;
    dmat[260] =   2.325595965874e-04;
    dmat[261] =   1.147794859329e-02;
    dmat[262] =  -5.044802935980e-03;
    dmat[263] =   8.823070460469e-04;
    dmat[264] =   2.106959819179e-19;
    dmat[265] =  -6.954177061324e-19;
    dmat[266] =   3.997745549303e-03;
    dmat[267] =   1.516892605146e-01;
    dmat[268] =  -1.480858033152e-01;
    dmat[269] =  -5.903237520676e-01;
    dmat[270] =  -5.587506064397e-16;
    dmat[271] =   1.857408973166e-15;
    dmat[272] =   8.546811623303e-02;
    dmat[273] =  -8.660574448648e-18;
    dmat[274] =   2.952603434641e-17;
    dmat[275] =  -8.188577127075e-18;
    dmat[276] =   0.000000000000e+00;
    dmat[277] =  -6.626796710079e-03;
    dmat[278] =   2.566820530999e-17;
    dmat[279] =   1.147794859329e-02;
    dmat[280] =   5.676124150509e-01;
    dmat[281] =  -2.498038873499e-01;
    dmat[282] =   4.443826475806e-02;
    dmat[283] =   2.688477326009e-17;
    dmat[284] =  -8.456145236759e-17;
    dmat[285] =  -3.957074064980e-04;
    dmat[286] =  -7.579356306024e-02;
    dmat[287] =   6.494868921324e-02;
    dmat[288] =   2.573872675260e-01;
    dmat[289] =   5.251770511735e-16;
    dmat[290] =  -1.701790489248e-15;
    dmat[291] =  -3.783606332525e-02;
    dmat[292] =   1.192535041887e-17;
    dmat[293] =  -3.870149159146e-17;
    dmat[294] =  -2.906136692737e-19;
    dmat[295] =   0.000000000000e+00;
    dmat[296] =   2.912618333097e-03;
    dmat[297] =   1.066988590732e-18;
    dmat[298] =  -5.044802935980e-03;
    dmat[299] =  -2.498038873499e-01;
    dmat[300] =   1.100325009820e-01;
    dmat[301] =  -1.979100163083e-02;
    dmat[302] =  -5.401708850482e-19;
    dmat[303] =   1.366470734728e-18;
    dmat[304] =  -4.898578168207e-04;
    dmat[305] =   3.450787865374e-02;
    dmat[306] =  -1.106166966204e-02;
    dmat[307] =  -4.018642354126e-02;
    dmat[308] =  -8.219399021337e-17;
    dmat[309] =   2.625606253250e-16;
    dmat[310] =   7.250661042343e-03;
    dmat[311] =  -1.894385246426e-18;
    dmat[312] =   6.061542580228e-18;
    dmat[313] =   1.042755863658e-19;
    dmat[314] =   0.000000000000e+00;
    dmat[315] =  -5.094002105433e-04;
    dmat[316] =  -3.555822098220e-19;
    dmat[317] =   8.823070460469e-04;
    dmat[318] =   4.443826475806e-02;
    dmat[319] =  -1.979100163083e-02;
    dmat[320] =   4.062611416622e-03;
    dmat[321] =  -9.799568236043e-20;
    dmat[322] =   3.803623968705e-19;
    dmat[323] =  -3.581858288823e-18;
    dmat[324] =  -2.013225673072e-17;
    dmat[325] =  -3.511440533640e-18;
    dmat[326] =  -5.648257781673e-17;
    dmat[327] =   3.668493529941e-02;
    dmat[328] =   2.710042210071e-19;
    dmat[329] =  -8.575436506057e-20;
    dmat[330] =   1.060356170457e-03;
    dmat[331] =  -1.165974145915e-19;
    dmat[332] =  -5.001242536768e-04;
    dmat[333] =   0.000000000000e+00;
    dmat[334] =  -1.216453818675e-19;
    dmat[335] =   2.691149404880e-20;
    dmat[336] =   2.106959819179e-19;
    dmat[337] =   2.688477326009e-17;
    dmat[338] =  -5.401708850482e-19;
    dmat[339] =  -9.799568236043e-20;
    dmat[340] =   1.447643042501e-03;
    dmat[341] =  -2.314534071985e-20;
    dmat[342] =   2.490899479252e-18;
    dmat[343] =   7.023700986329e-17;
    dmat[344] =   1.133298899672e-17;
    dmat[345] =   1.849936072692e-16;
    dmat[346] =  -4.757810534507e-19;
    dmat[347] =   3.668493529941e-02;
    dmat[348] =   3.850230337473e-19;
    dmat[349] =  -3.569967801147e-19;
    dmat[350] =   1.060356170457e-03;
    dmat[351] =   4.482367662333e-20;
    dmat[352] =   0.000000000000e+00;
    dmat[353] =   4.014995998348e-19;
    dmat[354] =  -5.001242536767e-04;
    dmat[355] =  -6.954177061324e-19;
    dmat[356] =  -8.456145236759e-17;
    dmat[357] =   1.366470734728e-18;
    dmat[358] =   3.803623968705e-19;
    dmat[359] =  -2.314534071985e-20;
    dmat[360] =   1.447643042501e-03;
    double xc_energy = 0.0;
    double num_electrons = 0.0;
    int dmat_to_pert[1]  = {0};
    int dmat_to_comp[1]  = {0};
    xc.integrate(XCINT_MODE_RKS,
                 0,
                 0,
                 0,
                 1,
                 dmat_to_pert,
                 dmat_to_comp,
                 dmat,
                 false,
                 xc_energy,
                 true,
                 xc_mat,
                 num_electrons);
    ASSERT_NEAR(xc_mat[0],  -2.827906118003e+00, 1.0e-11);
    ASSERT_NEAR(xc_mat[1],   3.331194635724e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[2],  -3.267619263847e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[3],  -9.491773043038e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[4],  -1.366424863583e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[5],  -6.817751352169e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[6],  -2.039399749012e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[7],   3.174932435496e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[8],  -4.735578629083e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[9],  -5.188847740407e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[10],  -3.538035590297e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[11],  -8.995239537205e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[12],   1.208987132846e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[13],   1.558021190469e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[14],  -9.989841648267e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[15],  -9.913104706087e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[16],  -1.877122242161e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[17],  -7.218344479383e-21, 1.0e-11);
    ASSERT_NEAR(xc_mat[18],  -4.572421707719e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[19],   3.331194635724e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[20],  -7.775345355332e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[21],  -5.729202741800e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[22],   5.665542739779e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[23],  -2.083193248996e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[24],   1.632426265788e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[25],   1.066813610626e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[26],  -8.210506757338e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[27],   2.442881541435e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[28],  -1.558650781553e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[29],  -1.997118636885e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[30],  -1.379955271939e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[31],   5.949831107676e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[32],   2.390152643173e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[33],  -2.685763960667e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[34],  -2.544911526818e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[35],  -3.229098209737e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[36],  -5.008888662806e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[37],   1.470321058100e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[38],  -3.267619263847e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[39],  -5.729202741800e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[40],  -5.886076404353e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[41],   9.233663100308e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[42],  -6.044471191680e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[43],   2.425101573196e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[44],   1.554591273293e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[45],  -1.110984439695e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[46],   2.728255141487e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[47],  -8.621448473879e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[48],   3.210342660728e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[49],  -1.513706307536e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[50],  -4.702116611056e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[51],   2.621816232409e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[52],  -2.976334027098e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[53],  -2.817148457791e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[54],  -3.150788679971e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[55],  -7.558830138026e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[56],   1.887827678773e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[57],  -9.491773043038e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[58],   5.665542739779e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[59],   9.233663100308e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[60],  -7.099066563948e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[61],  -3.796602346925e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[62],  -7.908193499649e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[63],  -3.990787915730e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[64],   2.884087981019e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[65],  -6.643496090934e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[66],  -5.305970401142e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[67],   3.728155517317e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[68],  -5.864032100831e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[69],   2.593927152353e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[70],   1.015680153585e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[71],   1.775556124054e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[72],   8.600474650631e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[73],   2.332399882708e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[74],   5.464734934901e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[75],  -1.883595715068e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[76],  -1.366424863583e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[77],  -2.083193248996e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[78],  -6.044471191680e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[79],  -3.796602346925e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[80],  -7.130106758901e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[81],  -2.899195912462e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[82],   3.298675090874e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[83],  -3.905788384039e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[84],  -5.149041602270e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[85],  -2.201183377152e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[86],   1.363183061281e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[87],  -1.258359283231e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[88],   9.335340427104e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[89],   6.380829829699e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[90],  -4.593449042000e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[91],  -6.321274065094e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[92],  -1.884872967191e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[93],  -1.579505862568e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[94],   5.726029671340e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[95],  -6.817751352169e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[96],   1.632426265788e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[97],   2.425101573196e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[98],  -7.908193499649e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[99],  -2.899195912462e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[100],  -7.130106758901e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[101],  -8.436269860368e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[102],  -5.479779963585e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[103],  -3.905788384039e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[104],   6.511677724108e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[105],  -5.603771050083e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[106],   1.663077827843e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[107],  -2.201183377151e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[108],  -5.012356366543e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[109],   1.708929812180e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[110],   1.767580214035e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[111],   6.762473045351e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[112],  -4.936621328364e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[113],  -1.579505862568e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[114],  -2.039399749012e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[115],   1.066813610626e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[116],   1.554591273293e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[117],  -3.990787915730e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[118],   3.298675090874e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[119],  -8.436269860368e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[120],  -3.836901991736e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[121],   5.222885068535e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[122],  -1.399484538140e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[123],  -2.932288638009e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[124],   1.846991441720e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[125],  -6.708058440683e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[126],   6.835183671358e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[127],   1.161869803940e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[128],   2.076036729107e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[129],   1.110897488623e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[130],   1.319581214900e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[131],   1.182268246239e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[132],  -3.462370400461e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[133],   3.174932435496e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[134],  -8.210506757338e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[135],  -1.110984439695e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[136],   2.884087981019e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[137],  -3.905788384039e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[138],  -5.479779963585e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[139],   5.222885068535e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[140],  -3.657229038875e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[141],   9.148535928541e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[142],   1.670946900391e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[143],   1.577412788657e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[144],  -9.019273965982e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[145],   3.617024127457e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[146],   5.667486267664e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[147],  -9.138611257250e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[148],  -8.932296961620e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[149],  -1.868836490225e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[150],  -1.631972414218e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[151],  -8.903699752258e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[152],  -4.735578629083e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[153],   2.442881541435e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[154],   2.728255141487e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[155],  -6.643496090934e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[156],  -5.149041602270e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[157],  -3.905788384039e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[158],  -1.399484538140e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[159],   9.148535928541e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[160],  -3.657229038875e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[161],   1.059132978570e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[162],  -5.697058274601e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[163],   1.685059450708e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[164],   1.670946900391e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[165],  -2.363604802458e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[166],   2.603333036925e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[167],   2.635286309052e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[168],   1.118565765002e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[169],   8.461629520679e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[170],  -1.631972414218e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[171],  -5.188847740407e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[172],  -1.558650781553e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[173],  -8.621448473879e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[174],  -5.305970401142e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[175],  -2.201183377152e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[176],   6.511677724108e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[177],  -2.932288638009e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[178],   1.670946900391e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[179],   1.059132978570e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[180],  -6.917612496969e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[181],  -8.157842059776e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[182],   1.412762353185e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[183],  -2.833532931672e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[184],   2.455919902134e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[185],   1.271483728601e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[186],   6.007938364081e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[187],   5.946581327521e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[188],   1.431690134465e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[189],  -1.302816250130e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[190],  -3.538035590297e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[191],  -1.997118636885e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[192],   3.210342660728e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[193],   3.728155517317e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[194],   1.363183061281e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[195],  -5.603771050083e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[196],   1.846991441720e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[197],   1.577412788657e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[198],  -5.697058274601e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[199],  -8.157842059776e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[200],  -6.967437892464e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[201],  -4.064165157759e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[202],  -5.332982331830e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[203],   1.269758503734e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[204],  -2.713160077221e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[205],   4.227772979729e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[206],  -9.440359911451e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[207],   3.531204766980e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[208],  -1.443802292524e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[209],  -8.995239537205e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[210],  -1.379955271939e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[211],  -1.513706307536e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[212],  -5.864032100831e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[213],  -1.258359283231e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[214],   1.663077827843e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[215],  -6.708058440683e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[216],  -9.019273965982e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[217],   1.685059450708e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[218],   1.412762353185e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[219],  -4.064165157759e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[220],  -6.967774525211e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[221],   9.698441232533e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[222],   5.828681955403e-05, 1.0e-11);
    ASSERT_NEAR(xc_mat[223],   3.338811254867e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[224],   5.333832706459e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[225],   4.655053000898e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[226],   2.608054925587e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[227],   5.634187975693e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[228],   1.208987132846e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[229],   5.949831107676e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[230],  -4.702116611056e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[231],   2.593927152353e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[232],   9.335340427104e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[233],  -2.201183377151e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[234],   6.835183671358e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[235],   3.617024127457e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[236],   1.670946900391e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[237],  -2.833532931672e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[238],  -5.332982331830e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[239],   9.698441232533e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[240],  -6.917612496969e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[241],   2.972473008573e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[242],  -4.176605977537e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[243],  -3.091720288819e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[244],  -5.180362081720e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[245],   2.653368837272e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[246],   1.431690134465e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[247],   1.558021190469e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[248],   2.390152643173e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[249],   2.621816232409e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[250],   1.015680153585e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[251],   6.380829829699e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[252],  -5.012356366543e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[253],   1.161869803940e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[254],   5.667486267664e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[255],  -2.363604802458e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[256],   2.455919902134e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[257],   1.269758503734e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[258],   5.828681955403e-05, 1.0e-11);
    ASSERT_NEAR(xc_mat[259],   2.972473008573e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[260],  -6.968447563430e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[261],  -5.782990730312e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[262],  -9.238469246658e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[263],  -8.062788309481e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[264],   1.405247877012e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[265],   1.538140489121e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[266],  -9.989841648267e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[267],  -2.685763960667e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[268],  -2.976334027098e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[269],   1.775556124054e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[270],  -4.593449042000e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[271],   1.708929812180e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[272],   2.076036729107e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[273],  -9.138611257250e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[274],   2.603333036925e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[275],   1.271483728601e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[276],  -2.713160077221e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[277],   3.338811254867e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[278],  -4.176605977537e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[279],  -5.782990730312e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[280],  -3.513365788906e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[281],  -2.656989469824e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[282],  -1.256068838605e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[283],  -1.471893535693e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[284],   4.585885932631e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[285],  -9.913104706087e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[286],  -2.544911526818e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[287],  -2.817148457791e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[288],   8.600474650631e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[289],  -6.321274065094e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[290],   1.767580214035e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[291],   1.110897488623e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[292],  -8.932296961620e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[293],   2.635286309052e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[294],   6.007938364081e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[295],   4.227772979729e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[296],   5.333832706459e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[297],  -3.091720288819e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[298],  -9.238469246658e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[299],  -2.656989469824e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[300],  -2.430457458689e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[301],  -1.038608802524e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[302],  -1.231161974680e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[303],   3.502107980530e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[304],  -1.877122242161e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[305],  -3.229098209737e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[306],  -3.150788679971e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[307],   2.332399882708e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[308],  -1.884872967191e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[309],   6.762473045351e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[310],   1.319581214900e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[311],  -1.868836490225e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[312],   1.118565765002e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[313],   5.946581327521e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[314],  -9.440359911451e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[315],   4.655053000898e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[316],  -5.180362081720e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[317],  -8.062788309481e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[318],  -1.256068838605e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[319],  -1.038608802524e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[320],  -4.463568151145e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[321],   4.337132815697e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[322],  -1.141291833771e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[323],  -7.218344479383e-21, 1.0e-11);
    ASSERT_NEAR(xc_mat[324],  -5.008888662806e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[325],  -7.558830138026e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[326],   5.464734934901e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[327],  -1.579505862568e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[328],  -4.936621328364e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[329],   1.182268246239e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[330],  -1.631972414218e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[331],   8.461629520679e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[332],   1.431690134465e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[333],   3.531204766980e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[334],   2.608054925587e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[335],   2.653368837272e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[336],   1.405247877012e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[337],  -1.471893535693e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[338],  -1.231161974680e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[339],   4.337132815697e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[340],  -3.399425737777e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[341],  -4.106952583956e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[342],  -4.572421707719e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[343],   1.470321058100e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[344],   1.887827678773e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[345],  -1.883595715068e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[346],   5.726029671340e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[347],  -1.579505862568e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[348],  -3.462370400461e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[349],  -8.903699752258e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[350],  -1.631972414218e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[351],  -1.302816250130e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[352],  -1.443802292524e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[353],   5.634187975693e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[354],   1.431690134465e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[355],   1.538140489121e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[356],   4.585885932631e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[357],   3.502107980530e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[358],  -1.141291833771e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[359],  -4.106952583956e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[360],  -3.399425737777e-01, 1.0e-11);
    MemAllocator::deallocate(dmat);
    MemAllocator::deallocate(xc_mat);
    MemAllocator::deallocate(center_xyz);
    MemAllocator::deallocate(center_element);
    MemAllocator::deallocate(shell_center);
    MemAllocator::deallocate(l_quantum_num);
    MemAllocator::deallocate(shell_num_primitives);
    MemAllocator::deallocate(primitive_exp);
    MemAllocator::deallocate(contraction_coef);
}
