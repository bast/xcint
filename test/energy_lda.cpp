#include "gtest/gtest.h"
#include "XCint.h"
#include "MemAllocator.h"
#include "xcint_c_interface.h"

TEST(energy, lda)
{
    XCint xc;
    xc.set_verbosity(0);
    int num_centers;
    int num_shells;
    double *center_xyz = NULL;
    int *center_element = NULL;
    int *shell_center = NULL;
    int *l_quantum_num = NULL;
    int *shell_num_primitives = NULL;
    double *primitive_exp = NULL;
    double *contraction_coef = NULL;
    size_t block_size;
    num_centers = 2;
    num_shells = 9;
    block_size = 3*num_centers*sizeof(double);
    center_xyz = (double*) MemAllocator::allocate(block_size);
    center_xyz[0] =   1.700000000000e+00;
    center_xyz[1] =   0.000000000000e+00;
    center_xyz[2] =   0.000000000000e+00;
    center_xyz[3] =   0.000000000000e+00;
    center_xyz[4] =   0.000000000000e+00;
    center_xyz[5] =   0.000000000000e+00;
    block_size = num_centers*sizeof(int);
    center_element = (int*) MemAllocator::allocate(block_size);
    center_element[0] = 9;
    center_element[1] = 1;
    block_size = num_shells*sizeof(int);
    shell_center = (int*) MemAllocator::allocate(block_size);
    l_quantum_num = (int*) MemAllocator::allocate(block_size);
    shell_num_primitives = (int*) MemAllocator::allocate(block_size);
    shell_center[0] = 1;
    l_quantum_num[0] = 0;
    shell_num_primitives[0] = 9;
    shell_center[1] = 1;
    l_quantum_num[1] = 0;
    shell_num_primitives[1] = 9;
    shell_center[2] = 1;
    l_quantum_num[2] = 0;
    shell_num_primitives[2] = 1;
    shell_center[3] = 1;
    l_quantum_num[3] = 1;
    shell_num_primitives[3] = 4;
    shell_center[4] = 1;
    l_quantum_num[4] = 1;
    shell_num_primitives[4] = 1;
    shell_center[5] = 1;
    l_quantum_num[5] = 2;
    shell_num_primitives[5] = 1;
    shell_center[6] = 2;
    l_quantum_num[6] = 0;
    shell_num_primitives[6] = 4;
    shell_center[7] = 2;
    l_quantum_num[7] = 0;
    shell_num_primitives[7] = 1;
    shell_center[8] = 2;
    l_quantum_num[8] = 1;
    shell_num_primitives[8] = 1;
    block_size = 31*sizeof(double);
    primitive_exp = (double*) MemAllocator::allocate(block_size);
    contraction_coef = (double*) MemAllocator::allocate(block_size);
    primitive_exp[0] =   1.471000000000e+04;
    contraction_coef[0] =   6.863650000000e-01;
    primitive_exp[1] =   2.207000000000e+03;
    contraction_coef[1] =   1.274350000000e+00;
    primitive_exp[2] =   5.028000000000e+02;
    contraction_coef[2] =   2.139130000000e+00;
    primitive_exp[3] =   1.426000000000e+02;
    contraction_coef[3] =   3.130550000000e+00;
    primitive_exp[4] =   4.647000000000e+01;
    contraction_coef[4] =   3.638230000000e+00;
    primitive_exp[5] =   1.670000000000e+01;
    contraction_coef[5] =   2.641480000000e+00;
    primitive_exp[6] =   6.356000000000e+00;
    contraction_coef[6] =   7.553570000000e-01;
    primitive_exp[7] =   1.316000000000e+00;
    contraction_coef[7] =   1.342700000000e-02;
    primitive_exp[8] =   3.897000000000e-01;
    contraction_coef[8] =  -8.197600000000e-04;
    primitive_exp[9] =   1.471000000000e+04;
    contraction_coef[9] =  -1.570740000000e-01;
    primitive_exp[10] =   2.207000000000e+03;
    contraction_coef[10] =  -3.001720000000e-01;
    primitive_exp[11] =   5.028000000000e+02;
    contraction_coef[11] =  -4.915140000000e-01;
    primitive_exp[12] =   1.426000000000e+02;
    contraction_coef[12] =  -7.849910000000e-01;
    primitive_exp[13] =   4.647000000000e+01;
    contraction_coef[13] =  -9.347560000000e-01;
    primitive_exp[14] =   1.670000000000e+01;
    contraction_coef[14] =  -1.005480000000e+00;
    primitive_exp[15] =   6.356000000000e+00;
    contraction_coef[15] =  -3.204660000000e-01;
    primitive_exp[16] =   1.316000000000e+00;
    contraction_coef[16] =   4.928530000000e-01;
    primitive_exp[17] =   3.897000000000e-01;
    contraction_coef[17] =   1.999410000000e-01;
    primitive_exp[18] =   3.897000000000e-01;
    contraction_coef[18] =   3.515260000000e-01;
    primitive_exp[19] =   2.267000000000e+01;
    contraction_coef[19] =   3.164380000000e+00;
    primitive_exp[20] =   4.977000000000e+00;
    contraction_coef[20] =   2.497710000000e+00;
    primitive_exp[21] =   1.347000000000e+00;
    contraction_coef[21] =   1.051860000000e+00;
    primitive_exp[22] =   3.471000000000e-01;
    contraction_coef[22] =   1.739750000000e-01;
    primitive_exp[23] =   3.471000000000e-01;
    contraction_coef[23] =   3.797590000000e-01;
    primitive_exp[24] =   1.640000000000e+00;
    contraction_coef[24] =   6.775590000000e+00;
    primitive_exp[25] =   1.301000000000e+01;
    contraction_coef[25] =   9.610660000000e-02;
    primitive_exp[26] =   1.962000000000e+00;
    contraction_coef[26] =   1.630200000000e-01;
    primitive_exp[27] =   4.446000000000e-01;
    contraction_coef[27] =   1.855450000000e-01;
    primitive_exp[28] =   1.220000000000e-01;
    contraction_coef[28] =   7.374380000000e-02;
    primitive_exp[29] =   1.220000000000e-01;
    contraction_coef[29] =   1.471230000000e-01;
    primitive_exp[30] =   7.270000000000e-01;
    contraction_coef[30] =   9.568810000000e-01;

    double hfx, mu, beta; // we don't care about it here
    xc.set_functional("lda", hfx, mu, beta);
    xc.set_basis(XCINT_BASIS_SPHERICAL,
                 num_centers,
                 center_xyz,
                 center_element,
                 num_shells,
                 shell_center,
                 l_quantum_num,
                 shell_num_primitives,
                 primitive_exp,
                 contraction_coef);
    xc.generate_grid(1.0e-12,
                     86,
                     302,
                     num_centers,
                     center_xyz,
                     center_element,
                     num_shells,
                     shell_center,
                     l_quantum_num,
                     shell_num_primitives,
                     primitive_exp);
    int mat_dim = 19;
    double *dmat = NULL;
    double *xc_mat = NULL;
    block_size = mat_dim*mat_dim*sizeof(double);
    dmat = (double*) MemAllocator::allocate(block_size);
    xc_mat = (double*) MemAllocator::allocate(block_size);
    dmat[0] =   1.007006744703e+00;
    dmat[1] =   8.524020246319e-03;
    dmat[2] =  -1.913517463803e-02;
    dmat[3] =  -8.640040075696e-03;
    dmat[4] =  -3.650023512293e-17;
    dmat[5] =   1.232690643721e-16;
    dmat[6] =   2.016135048780e-03;
    dmat[7] =  -1.920244171289e-18;
    dmat[8] =   3.446491637159e-18;
    dmat[9] =   1.731818267859e-18;
    dmat[10] =   0.000000000000e+00;
    dmat[11] =  -1.373086358909e-04;
    dmat[12] =  -9.446582359623e-19;
    dmat[13] =   2.378255336812e-04;
    dmat[14] =   3.313510584148e-03;
    dmat[15] =   3.582318408589e-04;
    dmat[16] =  -9.808679472161e-04;
    dmat[17] =  -3.963614170691e-18;
    dmat[18] =   2.617462680706e-18;
    dmat[19] =   8.524020246319e-03;
    dmat[20] =   8.864234480930e-01;
    dmat[21] =  -4.073012026704e-03;
    dmat[22] =   7.024766747215e-02;
    dmat[23] =  -1.758443764021e-16;
    dmat[24] =   5.491225259324e-16;
    dmat[25] =   4.742225668967e-02;
    dmat[26] =  -9.001404859059e-18;
    dmat[27] =   2.990450134999e-17;
    dmat[28] =   6.926417785568e-18;
    dmat[29] =   0.000000000000e+00;
    dmat[30] =  -1.820026289381e-03;
    dmat[31] =  -2.406523943071e-17;
    dmat[32] =   3.152378004318e-03;
    dmat[33] =   1.513601817934e-01;
    dmat[34] =  -7.276087881061e-02;
    dmat[35] =   3.476210852707e-02;
    dmat[36] =  -2.117200343565e-17;
    dmat[37] =   7.382545986867e-17;
    dmat[38] =  -1.913517463803e-02;
    dmat[39] =  -4.073012026704e-03;
    dmat[40] =   3.808645776634e-02;
    dmat[41] =   1.599421660580e-01;
    dmat[42] =   2.512317539313e-16;
    dmat[43] =  -8.203127252644e-16;
    dmat[44] =  -2.061395923696e-02;
    dmat[45] =   4.919886916220e-18;
    dmat[46] =  -1.608043780294e-17;
    dmat[47] =   9.422936166879e-19;
    dmat[48] =   0.000000000000e+00;
    dmat[49] =   1.679385562496e-03;
    dmat[50] =  -3.067678607289e-18;
    dmat[51] =  -2.908781119740e-03;
    dmat[52] =  -1.408831586336e-01;
    dmat[53] =   6.131376191995e-02;
    dmat[54] =  -9.198561533752e-03;
    dmat[55] =  -3.666963197861e-18;
    dmat[56] =   1.186590814836e-17;
    dmat[57] =  -8.640040075696e-03;
    dmat[58] =   7.024766747215e-02;
    dmat[59] =   1.599421660580e-01;
    dmat[60] =   6.853469832411e-01;
    dmat[61] =   5.312532765058e-17;
    dmat[62] =  -1.437052432440e-16;
    dmat[63] =  -8.272711349281e-02;
    dmat[64] =  -1.268342626783e-17;
    dmat[65] =   4.223952177969e-17;
    dmat[66] =   1.892711685244e-17;
    dmat[67] =   0.000000000000e+00;
    dmat[68] =   6.941961531658e-03;
    dmat[69] =  -6.202182739517e-17;
    dmat[70] =  -1.202383007702e-02;
    dmat[71] =  -5.830734532642e-01;
    dmat[72] =   2.532122504427e-01;
    dmat[73] =  -3.571545507150e-02;
    dmat[74] =  -5.940382778692e-17;
    dmat[75] =   1.945646041194e-16;
    dmat[76] =  -3.650023512293e-17;
    dmat[77] =  -1.758443764021e-16;
    dmat[78] =   2.512317539313e-16;
    dmat[79] =   5.312532765058e-17;
    dmat[80] =   9.225234222380e-01;
    dmat[81] =  -2.865545547786e-17;
    dmat[82] =  -1.693221726077e-16;
    dmat[83] =   3.022090769501e-02;
    dmat[84] =   1.789968739099e-17;
    dmat[85] =  -1.311210715170e-02;
    dmat[86] =   0.000000000000e+00;
    dmat[87] =   1.140259732281e-17;
    dmat[88] =  -8.228426706256e-19;
    dmat[89] =  -1.974987791151e-17;
    dmat[90] =  -5.378754408803e-16;
    dmat[91] =   5.133879712250e-16;
    dmat[92] =  -7.218875851217e-17;
    dmat[93] =   3.850540048750e-02;
    dmat[94] =  -2.962635458594e-18;
    dmat[95] =   1.232690643721e-16;
    dmat[96] =   5.491225259324e-16;
    dmat[97] =  -8.203127252644e-16;
    dmat[98] =  -1.437052432440e-16;
    dmat[99] =  -2.865545547786e-17;
    dmat[100] =   9.225234222380e-01;
    dmat[101] =   5.448818175365e-16;
    dmat[102] =   1.799829600540e-17;
    dmat[103] =   3.022090769502e-02;
    dmat[104] =  -6.229850812849e-19;
    dmat[105] =   0.000000000000e+00;
    dmat[106] =  -3.656992167388e-17;
    dmat[107] =  -1.311210715170e-02;
    dmat[108] =   6.334096236799e-17;
    dmat[109] =   1.789403072061e-15;
    dmat[110] =  -1.663851029411e-15;
    dmat[111] =   2.298980012418e-16;
    dmat[112] =  -2.114328239606e-18;
    dmat[113] =   3.850540048750e-02;
    dmat[114] =   2.016135048780e-03;
    dmat[115] =   4.742225668967e-02;
    dmat[116] =  -2.061395923696e-02;
    dmat[117] =  -8.272711349281e-02;
    dmat[118] =  -1.693221726077e-16;
    dmat[119] =   5.448818175365e-16;
    dmat[120] =   1.354027328425e-02;
    dmat[121] =  -3.918141848164e-18;
    dmat[122] =   1.263448201086e-17;
    dmat[123] =   1.845647697047e-19;
    dmat[124] =   0.000000000000e+00;
    dmat[125] =  -9.989208178770e-04;
    dmat[126] =  -6.277718165457e-19;
    dmat[127] =   1.730181609301e-03;
    dmat[128] =   8.380299335376e-02;
    dmat[129] =  -3.683950216674e-02;
    dmat[130] =   6.753429473392e-03;
    dmat[131] =  -1.082332078824e-19;
    dmat[132] =   4.627638141808e-19;
    dmat[133] =  -1.920244171289e-18;
    dmat[134] =  -9.001404859059e-18;
    dmat[135] =   4.919886916220e-18;
    dmat[136] =  -1.268342626783e-17;
    dmat[137] =   3.022090769501e-02;
    dmat[138] =   1.799829600540e-17;
    dmat[139] =  -3.918141848164e-18;
    dmat[140] =   9.900055000170e-04;
    dmat[141] =   1.206732171667e-18;
    dmat[142] =  -4.295389909529e-04;
    dmat[143] =   0.000000000000e+00;
    dmat[144] =   2.325320973713e-19;
    dmat[145] =  -2.961131043242e-19;
    dmat[146] =  -4.027574073702e-19;
    dmat[147] =  -5.766595938825e-18;
    dmat[148] =   1.168279550232e-17;
    dmat[149] =  -1.688562999099e-18;
    dmat[150] =   1.261396866292e-03;
    dmat[151] =   6.933633784844e-19;
    dmat[152] =   3.446491637159e-18;
    dmat[153] =   2.990450134999e-17;
    dmat[154] =  -1.608043780294e-17;
    dmat[155] =   4.223952177969e-17;
    dmat[156] =   1.789968739099e-17;
    dmat[157] =   3.022090769502e-02;
    dmat[158] =   1.263448201086e-17;
    dmat[159] =   1.206732171667e-18;
    dmat[160] =   9.900055000176e-04;
    dmat[161] =  -2.881644156254e-19;
    dmat[162] =   0.000000000000e+00;
    dmat[163] =  -7.429116019475e-19;
    dmat[164] =  -4.295389909531e-04;
    dmat[165] =   1.286760640106e-18;
    dmat[166] =   2.038397330761e-17;
    dmat[167] =  -3.795858554078e-17;
    dmat[168] =   5.395244700860e-18;
    dmat[169] =   7.170371971428e-19;
    dmat[170] =   1.261396866293e-03;
    dmat[171] =   1.731818267859e-18;
    dmat[172] =   6.926417785568e-18;
    dmat[173] =   9.422936166879e-19;
    dmat[174] =   1.892711685244e-17;
    dmat[175] =  -1.311210715170e-02;
    dmat[176] =  -6.229850812849e-19;
    dmat[177] =   1.845647697047e-19;
    dmat[178] =  -4.295389909529e-04;
    dmat[179] =  -2.881644156254e-19;
    dmat[180] =   1.863663835663e-04;
    dmat[181] =   0.000000000000e+00;
    dmat[182] =   3.032418592498e-20;
    dmat[183] =   2.633890896592e-20;
    dmat[184] =  -5.252303057593e-20;
    dmat[185] =  -8.530413514015e-18;
    dmat[186] =  -2.890183453380e-19;
    dmat[187] =   1.030216794514e-19;
    dmat[188] =  -5.472890172115e-04;
    dmat[189] =  -8.939657534939e-22;
    dmat[190] =   0.000000000000e+00;
    dmat[191] =   0.000000000000e+00;
    dmat[192] =   0.000000000000e+00;
    dmat[193] =   0.000000000000e+00;
    dmat[194] =   0.000000000000e+00;
    dmat[195] =   0.000000000000e+00;
    dmat[196] =   0.000000000000e+00;
    dmat[197] =   0.000000000000e+00;
    dmat[198] =   0.000000000000e+00;
    dmat[199] =   0.000000000000e+00;
    dmat[200] =   0.000000000000e+00;
    dmat[201] =   0.000000000000e+00;
    dmat[202] =   0.000000000000e+00;
    dmat[203] =   0.000000000000e+00;
    dmat[204] =   0.000000000000e+00;
    dmat[205] =   0.000000000000e+00;
    dmat[206] =   0.000000000000e+00;
    dmat[207] =   0.000000000000e+00;
    dmat[208] =   0.000000000000e+00;
    dmat[209] =  -1.373086358909e-04;
    dmat[210] =  -1.820026289381e-03;
    dmat[211] =   1.679385562496e-03;
    dmat[212] =   6.941961531658e-03;
    dmat[213] =   1.140259732281e-17;
    dmat[214] =  -3.656992167388e-17;
    dmat[215] =  -9.989208178770e-04;
    dmat[216] =   2.325320973713e-19;
    dmat[217] =  -7.429116019475e-19;
    dmat[218] =   3.032418592498e-20;
    dmat[219] =   0.000000000000e+00;
    dmat[220] =   7.760570466053e-05;
    dmat[221] =  -1.012266218412e-19;
    dmat[222] =  -1.344170234292e-04;
    dmat[223] =  -6.513776896370e-03;
    dmat[224] =   2.848946299205e-03;
    dmat[225] =  -4.723568425938e-04;
    dmat[226] =  -1.265209547451e-19;
    dmat[227] =   4.177498827495e-19;
    dmat[228] =  -9.446582359623e-19;
    dmat[229] =  -2.406523943071e-17;
    dmat[230] =  -3.067678607289e-18;
    dmat[231] =  -6.202182739517e-17;
    dmat[232] =  -8.228426706256e-19;
    dmat[233] =  -1.311210715170e-02;
    dmat[234] =  -6.277718165457e-19;
    dmat[235] =  -2.961131043242e-19;
    dmat[236] =  -4.295389909531e-04;
    dmat[237] =   2.633890896592e-20;
    dmat[238] =   0.000000000000e+00;
    dmat[239] =  -1.012266218412e-19;
    dmat[240] =   1.863663835662e-04;
    dmat[241] =   1.753296521075e-19;
    dmat[242] =   2.674237785805e-17;
    dmat[243] =   1.068088227451e-18;
    dmat[244] =  -3.528474153825e-19;
    dmat[245] =  -2.129312176963e-20;
    dmat[246] =  -5.472890172115e-04;
    dmat[247] =   2.378255336812e-04;
    dmat[248] =   3.152378004318e-03;
    dmat[249] =  -2.908781119740e-03;
    dmat[250] =  -1.202383007702e-02;
    dmat[251] =  -1.974987791151e-17;
    dmat[252] =   6.334096236799e-17;
    dmat[253] =   1.730181609301e-03;
    dmat[254] =  -4.027574073702e-19;
    dmat[255] =   1.286760640106e-18;
    dmat[256] =  -5.252303057593e-20;
    dmat[257] =   0.000000000000e+00;
    dmat[258] =  -1.344170234292e-04;
    dmat[259] =   1.753296521075e-19;
    dmat[260] =   2.328171139816e-04;
    dmat[261] =   1.128219253368e-02;
    dmat[262] =  -4.934519738259e-03;
    dmat[263] =   8.181460506753e-04;
    dmat[264] =   2.191407214168e-19;
    dmat[265] =  -7.235640217781e-19;
    dmat[266] =   3.313510584148e-03;
    dmat[267] =   1.513601817934e-01;
    dmat[268] =  -1.408831586336e-01;
    dmat[269] =  -5.830734532642e-01;
    dmat[270] =  -5.378754408803e-16;
    dmat[271] =   1.789403072061e-15;
    dmat[272] =   8.380299335376e-02;
    dmat[273] =  -5.766595938825e-18;
    dmat[274] =   2.038397330761e-17;
    dmat[275] =  -8.530413514015e-18;
    dmat[276] =   0.000000000000e+00;
    dmat[277] =  -6.513776896370e-03;
    dmat[278] =   2.674237785805e-17;
    dmat[279] =   1.128219253368e-02;
    dmat[280] =   5.467981651861e-01;
    dmat[281] =  -2.391585905977e-01;
    dmat[282] =   3.962356807742e-02;
    dmat[283] =   2.818983797786e-17;
    dmat[284] =  -8.865535132635e-17;
    dmat[285] =   3.582318408589e-04;
    dmat[286] =  -7.276087881061e-02;
    dmat[287] =   6.131376191995e-02;
    dmat[288] =   2.532122504427e-01;
    dmat[289] =   5.133879712250e-16;
    dmat[290] =  -1.663851029411e-15;
    dmat[291] =  -3.683950216674e-02;
    dmat[292] =   1.168279550232e-17;
    dmat[293] =  -3.795858554078e-17;
    dmat[294] =  -2.890183453380e-19;
    dmat[295] =   0.000000000000e+00;
    dmat[296] =   2.848946299205e-03;
    dmat[297] =   1.068088227451e-18;
    dmat[298] =  -4.934519738259e-03;
    dmat[299] =  -2.391585905977e-01;
    dmat[300] =   1.046575883118e-01;
    dmat[301] =  -1.751801112317e-02;
    dmat[302] =  -5.089910830358e-19;
    dmat[303] =   1.244432905216e-18;
    dmat[304] =  -9.808679472161e-04;
    dmat[305] =   3.476210852707e-02;
    dmat[306] =  -9.198561533752e-03;
    dmat[307] =  -3.571545507150e-02;
    dmat[308] =  -7.218875851217e-17;
    dmat[309] =   2.298980012418e-16;
    dmat[310] =   6.753429473392e-03;
    dmat[311] =  -1.688562999099e-18;
    dmat[312] =   5.395244700860e-18;
    dmat[313] =   1.030216794514e-19;
    dmat[314] =   0.000000000000e+00;
    dmat[315] =  -4.723568425938e-04;
    dmat[316] =  -3.528474153825e-19;
    dmat[317] =   8.181460506753e-04;
    dmat[318] =   3.962356807742e-02;
    dmat[319] =  -1.751801112317e-02;
    dmat[320] =   3.543728922920e-03;
    dmat[321] =  -1.245656018070e-19;
    dmat[322] =   4.706729353350e-19;
    dmat[323] =  -3.963614170691e-18;
    dmat[324] =  -2.117200343565e-17;
    dmat[325] =  -3.666963197861e-18;
    dmat[326] =  -5.940382778692e-17;
    dmat[327] =   3.850540048750e-02;
    dmat[328] =  -2.114328239606e-18;
    dmat[329] =  -1.082332078824e-19;
    dmat[330] =   1.261396866292e-03;
    dmat[331] =   7.170371971428e-19;
    dmat[332] =  -5.472890172115e-04;
    dmat[333] =   0.000000000000e+00;
    dmat[334] =  -1.265209547451e-19;
    dmat[335] =  -2.129312176963e-20;
    dmat[336] =   2.191407214168e-19;
    dmat[337] =   2.818983797786e-17;
    dmat[338] =  -5.089910830358e-19;
    dmat[339] =  -1.245656018070e-19;
    dmat[340] =   1.607185065400e-03;
    dmat[341] =  -1.619860426485e-19;
    dmat[342] =   2.617462680706e-18;
    dmat[343] =   7.382545986867e-17;
    dmat[344] =   1.186590814836e-17;
    dmat[345] =   1.945646041194e-16;
    dmat[346] =  -2.962635458594e-18;
    dmat[347] =   3.850540048750e-02;
    dmat[348] =   4.627638141808e-19;
    dmat[349] =   6.933633784844e-19;
    dmat[350] =   1.261396866293e-03;
    dmat[351] =  -8.939657534939e-22;
    dmat[352] =   0.000000000000e+00;
    dmat[353] =   4.177498827495e-19;
    dmat[354] =  -5.472890172115e-04;
    dmat[355] =  -7.235640217781e-19;
    dmat[356] =  -8.865535132635e-17;
    dmat[357] =   1.244432905216e-18;
    dmat[358] =   4.706729353350e-19;
    dmat[359] =  -1.619860426485e-19;
    dmat[360] =   1.607185065400e-03;
    double xc_energy = 0.0;
    double num_electrons = 0.0;
    int dmat_to_pert[1]  = {0};
    int dmat_to_comp[1]  = {0};
    xc.integrate(XCINT_MODE_RKS,
                 0,
                 0,
                 0,
                 1,
                 dmat_to_pert,
                 dmat_to_comp,
                 dmat,
                 false,
                 xc_energy,
                 true,
                 xc_mat,
                 num_electrons);
    ASSERT_NEAR(xc_mat[0],  -3.305808798011e+00, 1.0e-11);
    ASSERT_NEAR(xc_mat[1],   3.709255778348e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[2],  -3.944897957133e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[3],  -9.532934255168e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[4],  -2.445682253934e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[5],  -2.262522806381e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[6],  -1.858615669160e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[7],  -2.122140060469e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[8],  -5.175766465376e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[9],  -7.516059232351e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[10],  -1.684167262869e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[11],  -7.516258960685e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[12],   1.655585774084e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[13],   1.301854240275e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[14],  -1.207211763787e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[15],  -1.197615382852e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[16],  -2.267981137541e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[17],   1.010571568640e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[18],  -8.493769714362e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[19],   3.709255778348e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[20],  -9.492271807323e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[21],  -7.094175253196e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[22],   7.903522727820e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[23],  -8.929680145386e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[24],   1.705360983650e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[25],   1.326230975434e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[26],  -6.578414227258e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[27],   2.599112310697e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[28],  -2.403115905683e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[29],  -5.090155056801e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[30],  -6.592374971391e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[31],   1.079043750233e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[32],   1.141832839300e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[33],  -3.323975232178e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[34],  -3.154972534037e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[35],  -3.999292972645e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[36],  -5.625020417408e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[37],   1.671148805359e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[38],  -3.944897957133e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[39],  -7.094175253196e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[40],  -7.285952624969e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[41],   1.191613013044e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[42],  -6.212698813680e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[43],   3.089951476471e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[44],   1.919885574128e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[45],  -9.081249568499e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[46],   4.109801138752e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[47],   1.437718746580e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[48],  -1.087547240408e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[49],   5.074274094701e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[50],   2.185320285508e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[51],  -8.788900543550e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[52],  -3.683424170943e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[53],  -3.494114128819e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[54],  -3.899772609895e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[55],  -8.489762289561e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[56],   2.609512674982e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[57],  -9.532934255168e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[58],   7.903522727820e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[59],   1.191613013044e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[60],  -8.778664050787e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[61],   1.407716693830e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[62],  -1.649750532138e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[63],  -4.949719653828e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[64],   3.837398293624e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[65],  -7.442391644304e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[66],  -2.666544007078e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[67],  -1.020281117733e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[68],  -6.586159259615e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[69],  -8.770141325011e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[70],   1.140756246439e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[71],   2.190577554541e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[72],   1.065490535311e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[73],   2.893423033560e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[74],   4.987498551478e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[75],  -2.145625859570e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[76],  -2.445682253934e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[77],  -8.929680145386e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[78],  -6.212698813680e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[79],   1.407716693830e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[80],  -8.782658439207e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[81],   5.484656152694e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[82],   3.425810397667e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[83],  -4.844376514768e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[84],  -1.475382105640e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[85],   1.211388397202e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[86],   1.256850856453e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[87],   7.357348874738e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[88],  -2.086876385771e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[89],   6.486768237344e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[90],  -5.142059314647e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[91],  -5.145447760392e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[92],  -1.450564745092e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[93],  -1.969383752894e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[94],   5.077602529619e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[95],  -2.262522806381e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[96],   1.705360983650e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[97],   3.089951476471e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[98],  -1.649750532138e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[99],   5.484656152694e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[100],  -8.782658439207e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[101],  -9.691983000672e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[102],  -1.856500596764e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[103],  -4.844376514768e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[104],  -2.205129097361e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[105],  -4.287506221021e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[106],   2.295259546319e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[107],   1.211388397202e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[108],  -3.329805947119e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[109],   2.183475206081e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[110],   2.502834958092e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[111],   1.143887408815e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[112],  -6.669034232739e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[113],  -1.969383752894e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[114],  -1.858615669160e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[115],   1.326230975434e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[116],   1.919885574128e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[117],  -4.949719653828e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[118],   3.425810397667e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[119],  -9.691983000672e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[120],  -4.775593128412e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[121],   7.635449866888e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[122],  -2.146577482952e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[123],  -4.619713823845e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[124],  -2.374901164791e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[125],  -7.371327991971e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[126],   1.494560075676e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[127],   1.276751460135e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[128],   2.559541747712e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[129],   1.374284327411e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[130],   1.650992599047e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[131],   1.180706727965e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[132],  -4.856341603249e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[133],  -2.122140060469e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[134],  -6.578414227258e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[135],  -9.081249568499e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[136],   3.837398293624e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[137],  -4.844376514768e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[138],  -1.856500596764e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[139],   7.635449866888e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[140],  -4.567815003998e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[141],  -5.906764367823e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[142],   2.967066659453e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[143],   1.593561594067e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[144],   8.533129161082e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[145],  -2.109182309107e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[146],   5.661521357639e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[147],  -1.132675350862e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[148],  -1.450160238534e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[149],  -3.247307372920e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[150],  -2.051215616036e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[151],  -2.650001571861e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[152],  -5.175766465376e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[153],   2.599112310697e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[154],   4.109801138752e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[155],  -7.442391644304e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[156],  -1.475382105640e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[157],  -4.844376514768e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[158],  -2.146577482952e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[159],  -5.906764367823e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[160],  -4.567815003998e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[161],  -3.381820368892e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[162],  -3.455752985546e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[163],   2.103178596656e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[164],   2.967066659453e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[165],  -2.792782620695e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[166],   3.707224951683e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[167],   3.812678380956e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[168],   8.785293436639e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[169],  -1.042368312717e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[170],  -2.051215616036e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[171],  -7.516059232351e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[172],  -2.403115905683e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[173],   1.437718746580e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[174],  -2.666544007078e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[175],   1.211388397202e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[176],  -2.205129097361e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[177],  -4.619713823845e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[178],   2.967066659453e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[179],  -3.381820368892e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[180],  -8.523464769363e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[181],  -3.666040593228e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[182],   1.020856705422e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[183],  -5.147654577573e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[184],  -6.787041111294e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[185],  -1.391892169351e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[186],   1.022936834338e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[187],   2.982087138824e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[188],   1.783440899088e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[189],  -6.894271985401e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[190],  -1.684167262869e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[191],  -5.090155056801e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[192],  -1.087547240408e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[193],  -1.020281117733e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[194],   1.256850856453e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[195],  -4.287506221021e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[196],  -2.374901164791e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[197],   1.593561594067e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[198],  -3.455752985546e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[199],  -3.666040593228e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[200],  -8.558025136749e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[201],  -1.972105011368e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[202],  -1.104328205862e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[203],   7.110180865534e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[204],   1.675770751799e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[205],  -3.426676345199e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[206],   9.194128535167e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[207],   5.442021936667e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[208],  -1.141305744673e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[209],  -7.516258960685e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[210],  -6.592374971391e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[211],   5.074274094701e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[212],  -6.586159259615e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[213],   7.357348874738e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[214],   2.295259546319e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[215],  -7.371327991971e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[216],   8.533129161082e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[217],   2.103178596656e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[218],   1.020856705422e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[219],  -1.972105011368e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[220],  -8.562020346512e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[221],   1.018864465157e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[222],   6.919696184866e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[223],   4.081337483768e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[224],   6.602330268292e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[225],   5.755964365520e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[226],   4.580300303536e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[227],   4.003077385698e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[228],   1.655585774084e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[229],   1.079043750233e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[230],   2.185320285508e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[231],  -8.770141325011e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[232],  -2.086876385771e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[233],   1.211388397202e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[234],   1.494560075676e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[235],  -2.109182309107e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[236],   2.967066659453e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[237],  -5.147654577573e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[238],  -1.104328205862e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[239],   1.018864465157e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[240],  -8.523464769363e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[241],  -7.843865285754e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[242],  -6.973304756801e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[243],  -5.471762042862e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[244],  -1.063995653421e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[245],  -2.185332115554e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[246],   1.783440899088e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[247],   1.301854240275e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[248],   1.141832839300e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[249],  -8.788900543550e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[250],   1.140756246439e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[251],   6.486768237344e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[252],  -3.329805947119e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[253],   1.276751460135e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[254],   5.661521357639e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[255],  -2.792782620695e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[256],  -6.787041111294e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[257],   7.110180865534e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[258],   6.919696184866e-04, 1.0e-11);
    ASSERT_NEAR(xc_mat[259],  -7.843865285754e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[260],  -8.570010523422e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[261],  -7.069083884722e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[262],  -1.143557147303e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[263],  -9.969622727637e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[264],   1.397204915713e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[265],   2.827522049046e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[266],  -1.207211763787e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[267],  -3.323975232178e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[268],  -3.683424170943e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[269],   2.190577554541e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[270],  -5.142059314647e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[271],   2.183475206081e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[272],   2.559541747712e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[273],  -1.132675350862e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[274],   3.707224951683e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[275],  -1.391892169351e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[276],   1.675770751799e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[277],   4.081337483768e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[278],  -6.973304756801e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[279],  -7.069083884722e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[280],  -4.277970934314e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[281],  -3.222103369634e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[282],  -1.579876948211e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[283],  -1.659696240467e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[284],   5.803899963986e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[285],  -1.197615382852e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[286],  -3.154972534037e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[287],  -3.494114128819e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[288],   1.065490535311e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[289],  -5.145447760392e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[290],   2.502834958092e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[291],   1.374284327411e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[292],  -1.450160238534e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[293],   3.812678380956e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[294],   1.022936834338e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[295],  -3.426676345199e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[296],   6.602330268292e-03, 1.0e-11);
    ASSERT_NEAR(xc_mat[297],  -5.471762042862e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[298],  -1.143557147303e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[299],  -3.222103369634e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[300],  -2.904703245117e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[301],  -1.312454894252e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[302],  -1.605561529739e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[303],   5.169190002363e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[304],  -2.267981137541e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[305],  -3.999292972645e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[306],  -3.899772609895e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[307],   2.893423033560e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[308],  -1.450564745092e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[309],   1.143887408815e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[310],   1.650992599047e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[311],  -3.247307372920e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[312],   8.785293436639e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[313],   2.982087138824e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[314],   9.194128535167e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[315],   5.755964365520e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[316],  -1.063995653421e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[317],  -9.969622727637e-02, 1.0e-11);
    ASSERT_NEAR(xc_mat[318],  -1.579876948211e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[319],  -1.312454894252e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[320],  -5.511935371067e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[321],   6.088356379812e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[322],  -1.606111888533e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[323],   1.010571568640e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[324],  -5.625020417408e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[325],  -8.489762289561e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[326],   4.987498551478e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[327],  -1.969383752894e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[328],  -6.669034232739e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[329],   1.180706727965e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[330],  -2.051215616036e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[331],  -1.042368312717e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[332],   1.783440899088e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[333],   5.442021936667e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[334],   4.580300303536e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[335],  -2.185332115554e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[336],   1.397204915713e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[337],  -1.659696240467e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[338],  -1.605561529739e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[339],   6.088356379812e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[340],  -4.261601993568e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[341],  -2.155649106721e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[342],  -8.493769714362e-20, 1.0e-11);
    ASSERT_NEAR(xc_mat[343],   1.671148805359e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[344],   2.609512674982e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[345],  -2.145625859570e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[346],   5.077602529619e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[347],  -1.969383752894e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[348],  -4.856341603249e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[349],  -2.650001571861e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[350],  -2.051215616036e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[351],  -6.894271985401e-19, 1.0e-11);
    ASSERT_NEAR(xc_mat[352],  -1.141305744673e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[353],   4.003077385698e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[354],   1.783440899088e-01, 1.0e-11);
    ASSERT_NEAR(xc_mat[355],   2.827522049046e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[356],   5.803899963986e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[357],   5.169190002363e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[358],  -1.606111888533e-17, 1.0e-11);
    ASSERT_NEAR(xc_mat[359],  -2.155649106721e-18, 1.0e-11);
    ASSERT_NEAR(xc_mat[360],  -4.261601993568e-01, 1.0e-11);
    MemAllocator::deallocate(dmat);
    MemAllocator::deallocate(xc_mat);
    MemAllocator::deallocate(center_xyz);
    MemAllocator::deallocate(center_element);
    MemAllocator::deallocate(shell_center);
    MemAllocator::deallocate(l_quantum_num);
    MemAllocator::deallocate(shell_num_primitives);
    MemAllocator::deallocate(primitive_exp);
    MemAllocator::deallocate(contraction_coef);
}
